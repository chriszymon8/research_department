<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orders — The Gentry Timepieces</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100">
  <header class="px-6 py-6 border-b border-gray-800">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <a href="index.html" class="font-semibold">The Gentry Timepieces</a>
      <nav class="flex gap-4">
        <a href="catalog.html">Catalog</a>
        <a href="cart.html">Cart (<span id="cartCountDetail">0</span>)</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-10">
    <h1 class="text-2xl font-semibold mb-6">Orders</h1>

    <div id="ordersBox" class="bg-gray-800 rounded-lg p-6">
      <!-- populated by JS -->
    </div>

    <div class="mt-6">
      <a href="index.html" class="text-gray-400">Back to home</a>
    </div>
  </main>

  <script src="assets/scripts.js"></script>
  <script>
    (function(){
      const box = document.getElementById('ordersBox');
      function getCurrentUser(){ const raw = localStorage.getItem('gentry_user'); if(!raw) return null; try { return JSON.parse(raw); } catch(e){ localStorage.removeItem('gentry_user'); return null; } }
      const current = getCurrentUser();

      if(!box) return;

      if(!current){
        const p = document.createElement('p'); p.className = 'text-gray-400';
        p.textContent = 'Please sign in to view your orders.';
        const a = document.createElement('a'); a.href = 'login.html'; a.className = 'text-amber-300 ml-1'; a.textContent = 'Sign in';
        box.appendChild(p); box.appendChild(a);
        return;
      }

      const raw = localStorage.getItem('gentry_orders');
      let orders = [];
      try { orders = raw ? JSON.parse(raw) : []; } catch(e){ orders = []; }

      const myOrders = orders.filter(o => o.userId === current.id);

      if(!myOrders.length){
        const p = document.createElement('p'); p.className = 'text-gray-400';
        p.textContent = 'You have no orders yet.';
        box.appendChild(p);
        return;
      }

      myOrders.forEach(o => {
        const card = document.createElement('div'); card.className = 'bg-gray-900 p-4 rounded mb-4';
        const header = document.createElement('div'); header.className = 'flex items-center justify-between';
        const id = document.createElement('div'); id.className = 'font-semibold'; id.textContent = `Order #${o.id}`;
        const date = document.createElement('div'); date.className = 'text-sm text-gray-400'; date.textContent = new Date(o.date).toLocaleString();
        header.appendChild(id); header.appendChild(date);

        const list = document.createElement('div'); list.className = 'mt-3 space-y-2';
        (o.items || []).forEach(it => {
          const row = document.createElement('div'); row.className = 'flex items-center justify-between';
          const left = document.createElement('div'); left.className = 'flex items-center gap-3';
          const img = document.createElement('img'); img.src = it.img || 'assets/watches/placeholder.avif'; img.className = 'w-12 h-12 object-cover rounded';
          const name = document.createElement('div'); name.className = 'text-sm'; name.textContent = `${it.name} x ${it.qty}`;
          left.appendChild(img); left.appendChild(name);
          const price = document.createElement('div'); price.className = 'text-sm text-amber-300'; price.textContent = `₱${(it.price || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          row.appendChild(left); row.appendChild(price);
          list.appendChild(row);
        });

        const total = document.createElement('div'); total.className = 'mt-3 flex items-center justify-between';
        const tlabel = document.createElement('div'); tlabel.className = 'text-gray-400'; tlabel.textContent = 'Total';
        const tamount = document.createElement('div'); tamount.className = 'font-bold text-amber-300'; tamount.textContent = `₱${(o.total || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
        total.appendChild(tlabel); total.appendChild(tamount);

        card.appendChild(header); card.appendChild(list); card.appendChild(total);
        box.appendChild(card);
      });
    })();
  </script>
</body>
</html>
